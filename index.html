<!doctype html>
<html lang="id">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Hmmmm</title>
        <link rel="stylesheet" href="styles.css">
    </head>

    <body>
        <!-- HOME -->
        <section id="home" class="view" aria-hidden="false">
        <div class="flat-card" role="region" aria-label="Main card">
            <h1>WILLKOMMEN!⋆˙⟡</h1>
            <p class="subtitle">APAAN TUH!</p>

            <button id="openParty" 
                class="big-btn" 
                aria-haspopup="true">Tekan Woy!˵¬ᴗ¬˵
            </button>
        </div>
        </section>

        <!-- PARTY -->
        <section id="party" class="view" aria-hidden="true">
        <div class="party-wrap">
            <!-- LEFT: photo scroller -->
            <div class="left">
            <div class="photo-viewport" aria-hidden="false">
                <div class="photo-track-wrap">
                <div id="photoSequence" class="photo-sequence">
                    <div class="photo-set">
                    <img class="photo" src="Foto.jpeg" alt="Foto 1">
                    <img class="photo" src="Prop1.jfif" alt="Foto 2">
                    <img class="photo" src="Foto.jpeg" alt="Foto 3">
                    <img class="photo" src="Prop2.jfif" alt="Foto 4">
                    </div>
                    <div class="photo-set">
                    <img class="photo" src="Foto.jpeg" alt="Foto 1">
                    <img class="photo" src="Prop1.jfif" alt="Foto 2">
                    <img class="photo" src="Foto.jpeg" alt="Foto 3">
                    <img class="photo" src="Prop2.jfif" alt="Foto 4">
                    </div>
                </div>
                </div>
            </div>
            </div>

            <!-- CENTER -->
            <div class="center">
            <div>
                <div class="greeting">Happy Birthday also..</div>
                <div class="sub">Semoga bahagia, sehat, dan penuh tawa!</div>
            </div>

            <div class="btn-row" aria-hidden="false">
                <button class="img-btn" data-letter="1" aria-haspopup="dialog">
                <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 24 24'><rect rx='4' ry='4' width='20' height='14' x='2' y='5' fill='%23fff' stroke='%23888' stroke-width='1'/><path d='M4 7h16M4 10h16' stroke='%23888' stroke-width='0.8' stroke-linecap='round'/></svg>" alt="Surat 1">
                </button>

                <button class="img-btn" data-letter="2" aria-haspopup="dialog">
                <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 24 24'><rect rx='4' ry='4' width='20' height='14' x='2' y='5' fill='%23fff' stroke='%23888' stroke-width='1'/><path d='M4 9h16M4 12h10' stroke='%23888' stroke-width='0.8' stroke-linecap='round'/></svg>" alt="Surat 2">
                </button>
            </div>
            </div>

            <!-- RIGHT -->
            <div class="right">
            <div class="video-card">
                <video id="greetingVideo" playsinline controls loop preload="metadata" muted>
                <source src="Video.mp4" type="video/mp4" preload="auto"> 
                Video tidak tersedia.
                </video>
            </div>
            </div>
        </div>
        </section>

        <!-- audio -->
        <audio id="bgMusic" src="Happy Birthday (Piano Version).mp3" preload="auto"></audio>

        <!-- modal root -->
        <div id="modalRoot" aria-live="polite"></div>

        <script>
            /* Elements */
            const home = document.getElementById('home');
            const party = document.getElementById('party');
            const openBtn = document.getElementById('openParty');
            const audio = document.getElementById('bgMusic');
            const photoSequence = document.getElementById('photoSequence');
            const modalRoot = document.getElementById('modalRoot');

            /* state for confetti once */
            let confettiDone = false;

            /* NAV */
            openBtn.addEventListener('click', () => {
                location.hash = 'party';
                showParty(true); // came from click -> allow audio attempt
            });

            window.addEventListener('hashchange', () => {
                if(location.hash === '#party') showParty(false);
                else showHome();
            });

            function showHome(){
                party.style.display = 'none';
                party.setAttribute('aria-hidden','true');
                home.style.display = 'flex';
                audio.pause(); audio.currentTime = 0;
                stopPhotoScroll();
            }

            function showParty(userGesture){
                home.style.display = 'none';
                party.style.display = 'flex';
                party.setAttribute('aria-hidden','false');
                
                // audio: only try to play if userGesture true (button click). If not, will silently fail on some browsers.
                try { 
                    if(userGesture) { 
                        audio.currentTime = 0; audio.play().catch(()=>{

                        }); 
                    } 
                } catch(e){

                }
                    
                const video = document.getElementById('greetingVideo');
                try { 
                    video.play().catch(()=>{

                    }); 
                } catch(e){

                }
                
                
                startPhotoScroll();
                    if(!confettiDone){
                        confettiDone = true;
                        startConfettiExplosion();
                    }
            }

            /* PHOTO scroll */
            function startPhotoScroll(){
                const sets = photoSequence.querySelectorAll('.photo-set');
                
                if(sets.length < 2) return;
                    const imageCount = sets[0].children.length;
                    const duration = Math.max(10, imageCount * 5);
                    photoSequence.style.animation = `scrollDown ${duration}s linear infinite`;
                    photoSequence.classList.add('scrolling');
            }
                
            function stopPhotoScroll(){
                photoSequence.style.animation = '';
                photoSequence.classList.remove('scrolling');
            }

            /* CONFETTI EFFECT */
            function rand(min,max){ return Math.random()*(max-min)+min; }

            function createPiece(x, y, color, size){
                const el = document.createElement('div');
                el.className = 'confetti-piece';
                el.style.left = x + 'px';
                el.style.top = y + 'px';
                el.style.width = size + 'px';
                el.style.height = Math.round(size * 1.3) + 'px';
                el.style.background = color;
                el.style.borderRadius = (size/6) + 'px';
                el.style.opacity = '1';
                el.style.transform = `translate(0,0) rotate(${rand(0,360)}deg)`;
                el.style.transition = 'transform 3.2s cubic-bezier(.22,.9,.33,1), opacity 1s linear 2.2s';
                document.body.appendChild(el);
                return el;
            }

            function startConfettiExplosion(){
                const colors = ['#ffcc4d','#ff6b6b','#6be4c3','#8ec5ff','#d39bff','#ffd6a5'];
                
                const topOffset = Math.max(40, window.innerHeight * 0.12);
                const leftAnchor = {x: 40, y: topOffset};
                const rightAnchor = {x: window.innerWidth - 40, y: topOffset};

                const piecesPerSide = 200; // total ~160

                function launchFrom(anchor, side){
                    const size = Math.round(rand(3,8));
                    const color = colors[Math.floor(rand(0, colors.length))];
                    const el = createPiece(anchor.x, anchor.y, color, size);
    
                    const angleDeg = side === 'left' ? rand(-60,60) : rand(120,240);
                    const speed = rand(220,520); // px - base distance factor
                    const rad = angleDeg * Math.PI / 180;
                    const dx = Math.cos(rad) * speed * (rand(0.7,1.3));
                    const dy = Math.sin(rad) * speed * (rand(0.7,1.6)) + 120; // add downward bias

                    const extraFall = rand(200,420);
                    const finalDx = dx;
                    const finalDy = dy + extraFall;

                    const rotate = rand(360,1440);
                    const delay = rand(0, 220);

                    setTimeout(() => {
                        el.style.transform = `translate(${finalDx}px, ${finalDy}px) rotate(${rotate}deg)`;
                        setTimeout(()=> el.style.opacity = '0', 2200 + rand(0,800));
                        setTimeout(()=> el.remove(), 3600 + rand(0,800));
                    }, delay);
                }

                // launch pieces with small staggering
                for(let i=0;i<piecesPerSide;i++){
                    setTimeout(()=> launchFrom(leftAnchor,'left'), i * 8 + rand(0,80));
                    setTimeout(()=> launchFrom(rightAnchor,'right'), i * 8 + rand(0,80));
                }

                // optional small secondary "sparkle" burst slightly later (adds depth)
                setTimeout(()=>{
                    for(let j=0;j<60;j++){
                        setTimeout(()=> launchFrom({x: window.innerWidth/2 + rand(-80,80), y: topOffset + rand(-10,40)}, (j%2===0?'left':'right')), j*18);
                    }
                }, 350);
            }

            /* MODAL LETTERS */
            const letterContents = {
                1: {
                    title: 'Surat Dari Mama',
                    body: `<p>Anak Mama Sayang,</p>
                    <p>Selamat ualng tahun. Semoga panjang umur, sehat selalu, dan dilimpahkan rezeki yang lancar. Mama doakan
                    pekerjaanmu selalu dipermudah, langkahmu dijaga, dan hati selalu dikuatkan. Semoga Allah segera mempertemukan mu dengan
                    jodoh yang terbaik. Mama Sayang sama kamu.</p>
                    <p>Dengan cinta,</p><p><strong>- Mama</strong></p>`
                },
            
                2: {
                    title: 'Surat Dari Aing',
                    body: `<p>Yuhuuuu!</p>
                    <p>Pibesdey bro. Semoga Panjang umur dan sehat selalu, apalagi semoga rezekinya lancar maybe supaya kasih sa uang jajan mwhehehe¬‿¬
                    Btw nggak pintar dalam kata-kata, tapi makasih untuk bantuannya selama ini ama beberapa hadiah juga mwheheh¬‿¬ Dan yh ini web sa buat 
                    sendiri masih belajar btw, soale dikampus baru belajar dasarnya:'D belum sempurna tapi tahun depan moga dah baik. Sa pen hadiahin ko sesuatu 
                    nanti mama kasih pas ko kejayapura buat lebaran¬‿¬ Ditunggu! Dah tuh aja. Byee.</p>
                    <p>Salam hangat,</p><p><strong>- Sofia paling cantek</strong></p>`
                }
            };

            document.querySelectorAll('.img-btn').forEach(btn=>{
                btn.addEventListener('click', (e)=>{
                    const id = btn.getAttribute('data-letter');
                    openLetterModal(id);
                });
            });

            function openLetterModal(id){
                const data = letterContents[id] || {title:'Surat', body:'<p>(Kosong)</p>'};
                const backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop';
                backdrop.tabIndex = -1;
                backdrop.innerHTML = `<div class="letter" role="dialog" aria-modal="true" aria-label="${data.title}"><h2>${data.title}</h2>
                    <div>${data.body}</div></div>`;
                
                backdrop.addEventListener('click', (evt)=>{
                    if(evt.target === backdrop){
                        backdrop.remove();
                    }
                });
                modalRoot.appendChild(backdrop);
            }

            document.addEventListener('keydown', (e)=>{
                if(e.key === 'Escape'){
                    modalRoot.innerHTML = '';
                }
            });

            if(location.hash === '#party'){
                showParty(false);
            }else{
                showHome();
            }

            window.addEventListener('beforeunload', ()=> audio.pause());
        </script>
    </body>
</html>

